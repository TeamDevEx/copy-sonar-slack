# Sonarqube Slack Integration :handshake:

This action posts a Slack message in a specific channel to provide information about the SonarQube Quality Gate results when a scan is completed on a pull request. The information generated by the Quality Gate check will be posted into Slack with all of the appropriate links to point to the various parts of the SonarQube scan that was done.

## How it works? :gear:


## Prerequisites :construction:

1. The SonarQube project associated with your GitHub repository needs to have the ability to report your Quality Gate status to GitHub pull requests and branches. To do so, set the following project settings at **Project Settings -> General Settings -> DevOps Platform Integration**:
    - `Configuration name`: The configuration name that corresponds to your GitHub instance.
    - `Repository identifier`: The path of your repository URL.
2. A workflow under `.github/workflows` that does a static code analysis using SonarQube. An example can be found [HERE](https://github.com/telus/cdo-eptoolshelper-pali/tree/main/Actions/examples/sonarqube) based on your project language. Another example can be found [HERE](https://github.com/telus/unicorn-run-frontend/blob/main/.github/workflows/code-analysis.yaml) which includes linting and generating your test results before performing static code analysis in the same workflow.

## How to use this aaction? :compass:

### Inputs :inbox_tray:
- `slackToken`: A token to allow the use of your Slack Bot. This input should be a action secret in your repository (referenced as `${{ secrets.SLACK-BOT-TOKEN-NAME }}`).
- `channelID`: ID of the Slack channel to post the SonarQube Quality Gate results to.

### Outputs :outbox_tray:
- `slack-msg-payload`: A Slack message object (formatted using the slack-block-builder package) containing the results of the Quality Gate.

### Usage :memo:
To use this action, create a separate workflow YAML file under `.github/workflows` that has the content shown below. Replace the placeholder value for `channelID` to one that fits your use case and change `SLACK_BOT_TOKEN` to the name of your repository secret that stores your Slack bot token. The names and IDs of the workflow, job, and/or steps can be changed to your liking. 

``` yaml
name: SonarQube Slack Integration
on:
  check_run:
    type: ['completed']

jobs: 
    sonarqube-slack-integration:
      name: SonarQube Slack Integration
      if: github.event.check_run.app.name == 'sonarqube-telus-swe-np'
      runs-on: ubuntu-latest
        steps:
        - name: Run SonarQube Slack Integration
          uses: telus/cdo-actions-sonarqube-slack-integration@v1
          with:
            slackToken: ${{ secrets.SLACK_BOT_TOKEN }}
            channelID: '<channelID>'
```